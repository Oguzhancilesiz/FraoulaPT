@model FraoulaPT.DTOs.UserWeeklyFormDTOs.UserLastFormDTO

@if (Model == null)
{
    <div class="alert alert-warning text-center shadow-sm rounded">
        ⚠️ Form bilgisi bulunamadı.
    </div>
}
else
{
    <div class="p-3 p-md-4 rounded shadow-lg"
         style="background:var(--surface);color:var(--text);border:1px solid var(--border);">
        <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
            <h5 class="mb-0 fw-bold text-warning">
                📅 Form Tarihi: @Model.FormDate.ToString("dd.MM.yyyy")
            </h5>

            <a asp-controller="UserWeeklyForm" asp-action="Create"
               class="btn btn-sm fw-semibold text-white"
               style="background:var(--brand-grad);border:0;">
                <i class="bi bi-plus-circle me-1"></i> Yeni Form Doldur
            </a>
        </div>

        <div class="row g-3">
            <!-- 📏 Vücut Ölçüleri -->
            <div class="col-md-6">
                <div class="card h-100 border-0 shadow-sm"
                     style="background:rgba(255,255,255,.02);color:var(--text);">
                    <div class="card-body">
                        <h6 class="text-warning fw-bold mb-2">📏 Vücut Ölçüleri</h6>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item bg-transparent text-light border-secondary">
                                Kilo: <strong>@(Model.Weight?.ToString("0.0") ?? "-") kg</strong>
                            </li>
                            <li class="list-group-item bg-transparent text-light border-secondary">
                                Yağ Oranı: <strong>@(Model.FatPercent?.ToString("0.0") ?? "-") %</strong>
                            </li>
                            <li class="list-group-item bg-transparent text-light border-secondary">
                                Kas Kütlesi: <strong>@(Model.MuscleMass?.ToString("0.0") ?? "-") kg</strong>
                            </li>
                            <li class="list-group-item bg-transparent text-light border-secondary">
                                Bel: <strong>@(Model.Waist?.ToString("0.0") ?? "-") cm</strong>
                            </li>
                            <li class="list-group-item bg-transparent text-light border-secondary">
                                Kalça: <strong>@(Model.Hip?.ToString("0.0") ?? "-") cm</strong>
                            </li>
                            <li class="list-group-item bg-transparent text-light border-secondary">
                                Göğüs: <strong>@(Model.Chest?.ToString("0.0") ?? "-") cm</strong>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- 💪 Ek Ölçümler -->
            <div class="col-md-6">
                <div class="card h-100 border-0 shadow-sm"
                     style="background:rgba(255,255,255,.02);color:var(--text);">
                    <div class="card-body">
                        <h6 class="text-warning fw-bold mb-2">💪 Ek Ölçümler</h6>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item bg-transparent text-light border-secondary">
                                Kol: <strong>@(Model.Arm?.ToString("0.0") ?? "-") cm</strong>
                            </li>
                            <li class="list-group-item bg-transparent text-light border-secondary">
                                Bacak: <strong>@(Model.Leg?.ToString("0.0") ?? "-") cm</strong>
                            </li>
                            <li class="list-group-item bg-transparent text-light border-secondary">
                                Nabız: <strong>@(Model.RestingPulse?.ToString("0") ?? "-") bpm</strong>
                            </li>
                            <li class="list-group-item bg-transparent text-light border-secondary">
                                Tansiyon: <strong>@(Model.BloodPressure?.ToString("0.0") ?? "-")</strong>
                            </li>

                            <li class="list-group-item bg-transparent text-light border-secondary">
                                VO₂ Max: <strong>@(Model.Vo2Max?.ToString("0.0") ?? "-")</strong>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- 📝 Notlar -->
        <div class="row mt-4 g-3">
            <div class="col-md-4">
                <div class="card h-100 border-0 shadow-sm"
                     style="background:rgba(255,255,255,.02);color:var(--text);">
                    <div class="card-body">
                        <h6 class="text-warning fw-bold mb-2">🧘 Esneklik Notu</h6>
                        <p class="mb-0">@(!string.IsNullOrWhiteSpace(Model.FlexibilityNotes) ? Model.FlexibilityNotes : "-")</p>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card h-100 border-0 shadow-sm"
                     style="background:rgba(255,255,255,.02);color:var(--text);">
                    <div class="card-body">
                        <h6 class="text-warning fw-bold mb-2">📝 Kullanıcı Notu</h6>
                        <p class="mb-0">@(!string.IsNullOrWhiteSpace(Model.UserNote) ? Model.UserNote : "-")</p>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card h-100 border-0 shadow-sm"
                     style="background:rgba(255,255,255,.02);color:var(--text);">
                    <div class="card-body">
                        <h6 class="text-warning fw-bold mb-2">🎯 Koç Geri Bildirimi</h6>
                        <p class="mb-0">@(!string.IsNullOrWhiteSpace(Model.CoachFeedback) ? Model.CoachFeedback : "-")</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 📸 Gelişim Fotoğrafları -->
        @if (Model.ProgressPhotoUrls != null && Model.ProgressPhotoUrls.Any())
        {
            <div class="mt-4">
                <h6 class="text-warning fw-bold mb-2">📸 Gelişim Fotoğrafları</h6>
                <div class="row g-2">
                    @foreach (var url in Model.ProgressPhotoUrls)
                    {
                        <div class="col-6 col-md-4 col-lg-3">
                            <a href="javascript:void(0)" class="photo-open" data-src="@url" title="Büyüt">
                                <img src="@url" class="img-fluid rounded shadow-sm border border-secondary"
                                     alt="Progress Photo"
                                     style="object-fit:cover;width:100%;height:200px;" />
                            </a>
                        </div>
                    }
                </div>
            </div>
        }
    </div>

    <!-- Büyük foto modal -->
    <div class="modal fade" id="photoModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content" style="background:#000;border:1px solid var(--border);">
                <div class="modal-body p-0">
                    <img id="photoModalImg" src="" alt="Preview" style="width:100%;height:auto;display:block;">
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Kapat</button>
                </div>
            </div>
        </div>
    </div>

    @section Scripts {
        <script>
            // Foto lightbox
            (function(){
              const modalEl = document.getElementById('photoModal');
              const imgEl = document.getElementById('photoModalImg');
              if (!modalEl || !imgEl) return;

              const modal = new bootstrap.Modal(modalEl);

              document.querySelectorAll('.photo-open').forEach(a => {
                a.addEventListener('click', () => {
                  const src = a.getAttribute('data-src') || a.querySelector('img')?.getAttribute('src') || '';
                  if (!src) return;
                  imgEl.src = src;
                  modal.show();
                });
              });

              // Modal kapanınca src temizle (küçük performans/hafıza iyiliği)
              modalEl.addEventListener('hidden.bs.modal', () => {
                imgEl.src = '';
              });
            })();
        </script>
    }
}
