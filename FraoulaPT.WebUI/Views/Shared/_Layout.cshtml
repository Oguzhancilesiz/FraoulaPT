@{
    string fullName = User.FindFirst("FullName")?.Value ?? "Kullanıcı";
    string profilePhoto = User.FindFirst("ProfilePhotoUrl")?.Value ?? "/uploads/user-default.jpg";
    string currentController = ViewContext.RouteData.Values["controller"]?.ToString();
}

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title - FraoulaPT</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet" />

    <style>
        .text-orange {
            color: #ff8800 !important;
        }

        .bg-dark-gradient {
            background: linear-gradient(90deg, #000000, #333333);
        }

        footer {
            background-color: #000;
            color: white;
        }
    </style>
</head>
<body class="bg-light">

    <!-- Üst Navbar (Sadece büyük ekranlarda) -->
    <nav class="navbar navbar-expand-lg bg-dark-gradient d-none d-lg-flex">
        <div class="container">
            <a class="navbar-brand text-white fw-bold d-flex align-items-center" href="/">
                <img src="~/images/fraoulapt-logo.png" alt="Logo" width="40" class="me-2 rounded">
                Fraoula<span class="text-orange">PT</span>
            </a>
            <div class="collapse navbar-collapse justify-content-end">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link @(currentController == "Dashboard" ? "text-orange" : "text-white")" href="/">
                            <i class="bi bi-house-door"></i> Ana Sayfa
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link @(currentController == "Package" ? "text-orange" : "text-white")" asp-controller="Package" asp-action="Index">
                            <i class="bi bi-box2-heart"></i> Paketler
                        </a>
                    </li>
                    @if (User.Identity.IsAuthenticated)
                    {
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle text-white" href="#" data-bs-toggle="dropdown">
                                <img src="@profilePhoto" alt="@fullName" width="30" height="30" class="rounded-circle me-2"> @fullName
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li><a class="dropdown-item" asp-controller="Profile" asp-action="Detail">Profilim</a></li>
                                <li><a class="dropdown-item" asp-controller="Package" asp-action="MyPackages">Tüm Paketlerim</a></li>
                                <li><a class="dropdown-item" asp-controller="UserWeeklyForm" asp-action="Index">Vücut Ölçülerim</a></li>
                                <li><a class="dropdown-item" asp-controller="Workout" asp-action="MyWorkout">Antrenmanım</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-danger" asp-controller="Auth" asp-action="Logout">Çıkış</a></li>
                            </ul>
                        </li>
                    }
                    else
                    {
                        <li class="nav-item">
                            <a class="nav-link text-white" asp-controller="Auth" asp-action="Login">Giriş Yap</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-white" asp-controller="Auth" asp-action="Register">Kayıt Ol</a>
                        </li>
                    }
                </ul>
            </div>
        </div>
    </nav>

    <!-- Mobil Alt Navbar -->
    <nav class="navbar navbar-light bg-white border-top fixed-bottom d-flex d-lg-none justify-content-around">
        <a href="/" class="nav-link @(currentController == "Dashboard" ? "text-orange" : "text-dark")">
            <i class="bi bi-house-door fs-4"></i>
        </a>
        <a asp-controller="Package" asp-action="Index" class="nav-link @(currentController == "Package" ? "text-orange" : "text-dark")">
            <i class="bi bi-box2-heart fs-4"></i>
        </a>
        <a asp-controller="UserWeeklyForm" asp-action="Index" class="nav-link @(currentController == "UserWeeklyForm" ? "text-orange" : "text-dark")">
            <i class="bi bi-journal-check fs-4"></i>
        </a>
        <a asp-controller="Workout" asp-action="MyWorkout" class="nav-link @(currentController == "WorkoutProgram" ? "text-orange" : "text-dark")">
            <i class="bi bi-list-task fs-4"></i>
        </a>
        <a asp-controller="Profile" asp-action="Detail" class="nav-link">
            <img src="@profilePhoto" class="rounded-circle border border-warning" width="25" height="25" />
        </a>
    </nav>

    @if (User.Identity.IsAuthenticated && ViewBag.ProfileIncomplete == true)
    {
        <div class="alert alert-warning text-center mt-3">
            Profilini tamamlamadın! <a href="/Profile/CompleteProfile" class="fw-bold">Şimdi tamamla</a>
        </div>
    }

    <main class="container py-4">
        @RenderBody()
    </main>

    <footer class="text-center py-3">
        <div>© @DateTime.Now.Year FraoulaPT | Tüm hakları saklıdır.</div>
        <small>Sporcu Takip ve Online Danışmanlık Platformu</small>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    @await RenderSectionAsync("Scripts", false)

    @if (TempData["AlertMessage"] != null)
    {
        <script>
            Swal.fire({
                title: @Html.Raw(Json.Serialize(TempData["AlertTitle"] ?? "")),
                text: @Html.Raw(Json.Serialize(TempData["AlertMessage"])),
                icon: @Html.Raw(Json.Serialize(TempData["AlertType"] ?? "info")),
                confirmButtonText: 'Tamam',
                timer: 3000
            });
        </script>
    }
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var message = '@Html.Raw(TempData["message"])';
            var type = '@TempData["messageType"]';
            if (message) {
                Toastify({
                    text: message,
                    duration: 4000,
                    gravity: "top",
                    position: "right",
                    backgroundColor: type === "success" ? "#28a745" :
                                     type === "error" ? "#dc3545" :
                                     type === "warning" ? "#ffc107" : "#17a2b8",
                    close: true
                }).showToast();
            }
        });
    </script>

    @{
        var alert = Context.Request.Query["alert"].ToString();
    }

    @section Scripts {
        @if (!string.IsNullOrEmpty(alert))
        {
            <script>
                Swal.fire({
                    icon: 'warning',
                    title: 'Uyarı',
                    text: '@alert',
                    confirmButtonText: 'Tamam'
                });
            </script>
        }
    }

</body>
</html>
