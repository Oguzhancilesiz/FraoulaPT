@model List<FraoulaPT.DTOs.UserProgramDTO.WorkoutProgramDTO>
@{
    ViewBag.Title = "Antrenman Programlarım";
    var now = DateTime.Now.Date;
}

<h2 class="mb-4"><i class="bi bi-list-task"></i> @ViewBag.Title</h2>

@if (!Model.Any())
{
    <div class="alert alert-info">
        Sana atanmış bir antrenman programı bulunamadı.
    </div>
}
else
{
    // Önce aktif programı öne çıkar (varsa)
    var active = Model.FirstOrDefault(p => p.Id == (Guid?)ViewBag.ActiveProgramId);
    if (active != null)
    {
        <div class="card shadow mb-4 border-success border-3">
            <div class="card-header bg-success text-white fw-bold d-flex justify-content-between align-items-center">
                <span><i class="bi bi-lightning-charge-fill"></i> Şu Anki Aktif Program</span>
                <span class="badge bg-light text-success ms-2">Devam Ediyor</span>
            </div>
            <div class="card-body">
                <h4>@active.Title</h4>
                <p class="mb-1">
                    <b>Tarih:</b> @active.StartDate.ToString("dd.MM.yyyy") - @active.EndDate.ToString("dd.MM.yyyy")<br />
                    <b>Koç Notu:</b> @active.CoachNote
                </p>
                <a href="@Url.Action("Detail", "WorkoutProgram", new { id = active.Id })" class="btn btn-outline-success">
                    Detay
                </a>
            </div>
        </div>
    }

    // Diğer programlar (aktif hariç), son verilen programı işaretle
    <ul class="list-group">
        @foreach (var program in Model
       .OrderByDescending(p => p.StartDate)
       .Where(p => active == null || p.Id != active.Id))
        {
            bool isActive = (program.StartDate <= now && program.EndDate >= now);
            bool isFinished = program.EndDate < now;
            bool isLatest = (program.Id == (Guid?)ViewBag.LatestProgramId);

            <li class="list-group-item d-flex justify-content-between align-items-center @(isFinished ? "bg-light text-muted" : "")">
                <div>
                    <b>@program.Title</b>
                    <span class="ms-2 small text-muted">(@program.StartDate.ToString("dd.MM.yyyy") - @program.EndDate.ToString("dd.MM.yyyy"))</span>
                    @if (!string.IsNullOrEmpty(program.CoachNote))
                    {
                        <span class="badge bg-info ms-2">@program.CoachNote</span>
                    }
                </div>
                <div>
                    <a href="@Url.Action("Detail", "WorkoutProgram", new { id = program.Id })"
                       class="btn btn-sm btn-outline-primary me-1">
                        Detay
                    </a>
                    @if (isActive)
                    {
                        <span class="badge bg-success">Devam Ediyor</span>
                    }
                    else if (isFinished)
                    {
                        <span class="badge bg-secondary">Bitti</span>
                    }
                    else if (isLatest)
                    {
                        <span class="badge bg-warning text-dark">Son Verilen</span>
                    }
                </div>
            </li>
        }
    </ul>
}
